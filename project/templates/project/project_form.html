{% load static %}
{% load widget_tweaks %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% if form.instance.pk %}Edit{% else %}Create{% endif %} Project</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }
        .form-input {
            transition: all 0.3s ease;
        }
        .form-input:focus {
            box-shadow: 0 0 0 3px rgba(0, 174, 239, 0.3);
        }
        .select2-container .select2-selection--multiple {
            min-height: 44px;
            background-color: #2c2f48 !important;
            border: none !important;
        }
        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: #00AEEF !important;
            border: none !important;
            color: white !important;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 font-['Inter'] min-h-screen p-4 md:p-8">

    <!-- Flash Messages -->
    {% if messages %}
    <div class="max-w-3xl mx-auto mb-6 fade-in">
        {% for message in messages %}
        <div class="rounded-xl px-5 py-4 mb-3 text-sm font-medium border backdrop-blur-sm
            {% if message.tags == 'error' %}
                bg-red-900/30 text-red-300 border-red-700/50 shadow-red-500/10
            {% elif message.tags == 'success' %}
                bg-green-900/30 text-green-300 border-green-700/50 shadow-green-500/10
            {% else %}
                bg-blue-900/30 text-blue-300 border-blue-700/50 shadow-blue-500/10
            {% endif %} shadow-lg flex items-center">
            <i class="fas 
                {% if message.tags == 'error' %}fa-exclamation-circle 
                {% elif message.tags == 'success' %}fa-check-circle 
                {% else %}fa-info-circle{% endif %} 
                mr-3"></i>
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Form Card -->
    <div class="gradient-bg rounded-2xl shadow-2xl max-w-3xl mx-auto p-6 md:p-8 space-y-6 border border-gray-800/50 backdrop-blur-sm fade-in">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl md:text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
                <i class="fas fa-project-diagram mr-2"></i>
                {% if form.instance.pk %}Edit Project{% else %}Create New Project{% endif %}
            </h2>
            <a href="{% url 'project:project_tab' %}" class="text-gray-400 hover:text-gray-200 transition-colors">
                <i class="fas fa-times"></i>
            </a>
        </div>

        <form method="post" class="space-y-6">
            {% csrf_token %}
            
            <!-- Title Field -->
            <div>
                <label for="id_title" class="block text-sm font-medium text-gray-300 mb-2">
                    <i class="fas fa-heading mr-2"></i>Project Title
                </label>
                {% render_field form.title class="form-input w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-cyan-500 focus:outline-none text-white" placeholder="Enter project title" %}
            </div>

            <!-- Description Field -->
            <div>
                <label for="id_description" class="block text-sm font-medium text-gray-300 mb-2">
                    <i class="fas fa-align-left mr-2"></i>Description
                </label>
                {% render_field form.description class="form-input w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-cyan-500 focus:outline-none text-white" rows="4" placeholder="Describe the project..." %}
            </div>

            <!-- Status & Dates -->
            <div class="grid md:grid-cols-3 gap-6">
                <!-- Status -->
                <div>
                    <label for="id_status" class="block text-sm font-medium text-gray-300 mb-2">
                        <i class="fas fa-tasks mr-2"></i>Status
                    </label>
                    {% render_field form.status class="form-input w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-cyan-500 focus:outline-none text-white" %}
                </div>
                
                <!-- Start Date -->
                <div>
                    <label for="id_start_date" class="block text-sm font-medium text-gray-300 mb-2">
                        <i class="far fa-calendar-plus mr-2"></i>Start Date
                    </label>
                    {% render_field form.start_date class="form-input w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-cyan-500 focus:outline-none text-white" %}
                </div>
                
                <!-- End Date -->
                <div>
                    <label for="id_end_date" class="block text-sm font-medium text-gray-300 mb-2">
                        <i class="far fa-calendar-check mr-2"></i>End Date
                    </label>
                    {% render_field form.end_date class="form-input w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-cyan-500 focus:outline-none text-white" %}
                </div>
            </div>

            <!-- Assigned Users -->
            <div>
                <label for="id_assigned_users" class="block text-sm font-medium text-gray-300 mb-2">
                    <i class="fas fa-users mr-2"></i>Team Members
                </label>
                {% render_field form.assigned_users class="form-input w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 focus:border-cyan-500 focus:outline-none text-white" %}
                <p class="mt-1 text-xs text-gray-500">Hold Ctrl/Cmd to select multiple users</p>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row justify-between gap-4 pt-6 border-t border-gray-800/50">
                <button type="submit" class="flex items-center justify-center bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white font-medium py-3 px-6 rounded-lg transition-all shadow-lg hover:shadow-cyan-500/20">
                    <i class="fas fa-save mr-2"></i> Save Project
                </button>
                <a href="{% url 'project:project_tab' %}" class="flex items-center justify-center bg-gray-800 hover:bg-gray-700 text-gray-300 font-medium py-3 px-6 rounded-lg transition-all">
                    <i class="fas fa-times mr-2"></i> Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Date Picker Enhancement -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        // Initialize date pickers with better UX
        const dateInputs = document.querySelectorAll('input[type="date"]');
        dateInputs.forEach(input => {
            // Add a nice calendar icon
            const wrapper = document.createElement('div');
            wrapper.className = 'relative';
            input.parentNode.insertBefore(wrapper, input);
            wrapper.appendChild(input);
            
            const icon = document.createElement('i');
            icon.className = 'fas fa-calendar-alt absolute right-3 top-3 text-gray-400 pointer-events-none';
            wrapper.appendChild(icon);
            
            // Improve date display format
            input.addEventListener('change', function() {
                if (this.value) {
                    const formattedDate = new Date(this.value).toLocaleDateString();
                    this.setAttribute('data-formatted', formattedDate);
                }
            });
        });

        // Enhance form validation
        const form = document.querySelector('form');
        form.addEventListener('submit', function(e) {
            const startDate = new Date(document.getElementById('id_start_date').value);
            const endDate = new Date(document.getElementById('id_end_date').value);
            
            if (startDate && endDate && startDate > endDate) {
                alert('End date must be after start date');
                e.preventDefault();
            }
        });
    });
    </script>

    <!-- Select2 for better multi-select -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
    $(document).ready(function() {
        $('#id_assigned_users').select2({
            placeholder: "Select team members",
            width: '100%',
            theme: 'dark'
        });
    });
    </script>
    <style>
    .select2-container--dark .select2-selection--multiple {
        background-color: #2c2f48 !important;
        border-color: #3b4253 !important;
    }
    </style>
</body>
</html>